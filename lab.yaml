# Lab CLI Configuration
# Network configuration
network: "10.11.3.0/24"

apt-cache-ct: apt-cache 

# Template generation configuration
templates:
  - name: ubuntu-tmpl
    id: 3010
    ip: 10  # Last octet only
    hostname: "ubuntu-tmpl"
    template: base
    resources:
      memory: 2048
      swap: 2048
      cores: 4
      rootfs_size: 20
    actions:
      - apt cache proxy configuration
      - AppArmor parser stub
      - apt sources fix
      - system upgrade
      - openssh-server installation
      - SSH service enablement
      - base tools installation
      - template cleanup
      - template archive creation
ct:
  - name: apt-cache
    id: 3020
    ip: 20  # Last octet only
    hostname: "apt-cache"
    template: ubuntu-tmpl
    resources:
      memory: 2048
      swap: 2048
      cores: 4
      rootfs_size: 20
    actions:
      - cloud-init wait
      - AppArmor parser stub
      - disable automatic apt units
      - systemd sysctl override
      - apt-cacher-ng installation
      - apt-cacher-ng port configuration
      - apt-cacher-ng service enablement
  - name: pgsql
    id: 3018
    ip: 18  # Last octet only
    hostname: "pgsql"
    template: ubuntu-tmpl
    resources:
      memory: 2048
      swap: 2048
      cores: 2
      rootfs_size: 30
    params:
      version: "17"
      port: 5432
      data_dir: "/var/lib/postgresql/data"
    actions:
      - cloud-init wait
      - postgresql installation
      - postgresql service configuration
      - postgresql files configuration
      - postgresql password setup
  - name: haproxy
    id: 3017
    ip: 17  # Last octet only
    hostname: "haproxy"
    template: ubuntu-tmpl
    resources:
      memory: 1024
      swap: 1024
      cores: 2
      rootfs_size: 10
    params:
      http_port: 80
      https_port: 443
      stats_port: 8404
    actions:
      - cloud-init wait
      - haproxy installation
      - haproxy configuration
      - haproxy systemd override
      - haproxy service enablement
  - name: dns
    id: 3019
    ip: 19  # Last octet only
    hostname: "dns"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 2048
      swap: 2048
      cores: 4
      rootfs_size: 20
    params:
      dns_port: 53
      web_port: 80
      postgres_host: "10.11.3.18"
      postgres_port: 5432
      postgres_db: "dns_server"
      postgres_user: "postgres"
      postgres_password: "postgres"
    actions:
      - cloud-init wait
      - dotnet installation
      - disable systemd resolved
      - sins dns installation
      - sins dns service configuration
      - sins dns service enablement
  - name: k3s-control
    id: 3011
    ip: 11  # Last octet only
    hostname: "k3s-control"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 4096
      swap: 4096
      cores: 8
      rootfs_size: 40
    params:
      port: 6443
    actions:
      - cloud-init wait
      - lxc sysctl access configuration
      - k3s installation
  - name: k3s-worker-1
    id: 3012
    ip: 12  # Last octet only
    hostname: "k3s-worker-1"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 4096
      swap: 4096
      cores: 8
      rootfs_size: 40
    actions:
      - cloud-init wait
      - lxc sysctl access configuration
      - k3s installation
  - name: k3s-worker-2
    id: 3013
    ip: 13  # Last octet only
    hostname: "k3s-worker-2"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 4096
      swap: 4096
      cores: 8
      rootfs_size: 40
    actions:
      - cloud-init wait
      - lxc sysctl access configuration
      - k3s installation
  - name: k3s-worker-3
    id: 3014
    ip: 14  # Last octet only
    hostname: "k3s-worker-3"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 4096
      swap: 4096
      cores: 8
      rootfs_size: 40
    actions:
      - cloud-init wait
      - lxc sysctl access configuration
      - k3s installation
  - name: glusterfs-node-1
    id: 3021
    ip: 21  # Last octet only
    hostname: "glusterfs-node-1"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 4096
      swap: 4096
      cores: 8
      rootfs_size: 40
    actions:
      - cloud-init wait
      - glusterfs server installation
  - name: glusterfs-node-2
    id: 3022
    ip: 22  # Last octet only
    hostname: "glusterfs-node-2"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 4096
      swap: 4096
      cores: 8
      rootfs_size: 40
    actions:
      - cloud-init wait
      - glusterfs server installation
  - name: glusterfs-node-3
    id: 3023
    ip: 23  # Last octet only
    hostname: "glusterfs-node-3"
    template: ubuntu-tmpl
    privileged: true
    nested: true
    resources:
      memory: 4096
      swap: 4096
      cores: 8
      rootfs_size: 40
    actions:
      - cloud-init wait
      - glusterfs server installation

kubernetes:
  control:
    - id: 3011
  workers:
    - id: 3012
    - id: 3013
    - id: 3014

# Script timeouts (in seconds)
timeouts:
  apt_cache: 900
  ubuntu_template: 1200

# Proxmox/LXC constants
proxmox:
  host: "root@10.11.3.4"
  storage: "sdb"
  bridge: "vmbr0"
  template_dir: "/var/lib/vz/template/cache"
  gateway_octet: 253  # Last octet of gateway IP

# User configuration
users:
  - name: "jaal"
    password: "jaal123"
    sudo_group: "sudo"

# Network services
services:
  apt_cache:
    port: 3142
  postgresql:
    port: 5432
    username: postgres
    password: postgres
    database: postgres
  haproxy:
    http_port: 80
    https_port: 443
    stats_port: 8404
  rancher:
    port: 30443
    image: "rancher/rancher:latest"

# DNS servers
dns:
  servers:
    - "8.8.8.8"
    - "8.8.4.4"
    - "10.11.2.5"

# Docker configuration
docker:
  version: "28.4.0"
  repository: "noble"
  release: "stable"
  ubuntu_release: "24.04"

# Base templates and patterns
template_config:
  base:
    - "ubuntu-25.04-standard_25.04-1.1_amd64.tar.zst"
#    - "ubuntu-24.04-standard_24.04-1_amd64.tar.zst"
#    - "ubuntu-24.10-standard_24.10-1_amd64.tar.zst"
  patterns:
    ubuntu: "ubuntu-25.04-template_{date}_amd64.tar.zst"
  preserve:
    - "ubuntu-24.10-standard_24.10-1_amd64.tar.zst"
    - "ubuntu-25.04-template_*.tar.zst"

# SSH configuration
ssh:
  connect_timeout: 10
  batch_mode: true

# Wait/retry configuration
waits:
  container_startup: 20
  container_ready_max_attempts: 30
  container_ready_sleep: 3
  network_config: 5
  service_start: 10
  glusterfs_setup: 30

# GlusterFS distributed storage configuration
glusterfs:
  volume_name: "shared-storage"
  brick_path: "/gluster/brick"
  mount_point: "/mnt/gluster"
  replica_count: 3  # Replicate across 3 GlusterFS nodes
  cluster_nodes:
    - id: 3021
    - id: 3022
    - id: 3023

